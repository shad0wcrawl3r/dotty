(defwindow mainBar
  :monitor 0
  :windowtype "dock"
  :stacking "bg"
  :geometry (geometry :anchor "top center" :x 0 :y 0 :width "80%" :height "10px" )
  :exclusive  true
  (bar)
  )


(defwidget bar []
  (centerbox :orientation "h"
    (workspaces)
    (music)
    (sidebar)
    ))

(defwidget workspaces []
  (box :class "workspaces"
       :orientation "h"
       :space-evenly true
       :halign "start"
       :spacing 10
    (button :onclick "hyprctl dispatch workspace 1" 1)
    (button :onclick "hyprctl dispatch workspace 2" 2)
    (button :onclick "hyprctl dispatch workspace 3" 3)
    (button :onclick "hyprctl dispatch workspace 4" 4)
    (button :onclick "hyprctl dispatch workspace 5" 5)
    (button :onclick "hyprctl dispatch workspace 6" 6)
    (button :onclick "hyprctl dispatch workspace 7" 7)
    (button :onclick "hyprctl dispatch workspace 8" 8)
    (button :onclick "hyprctl dispatch workspace 9" 9)))



(defvar battery_icons "ï–‚ï•¹ï•ºï•»ï•¼ï•½ï•¾ï•¿ï–€ï–ï•¸")
;(defvar battery_icon " ï‰€")
(defvar volume_icon "ï©¾")

(defvar volume_up_icon "ï©½")
(defvar volume_down_icon "ïª€")
(defvar lock_icon "ğŸ”’")
(defvar power_icon "ï¤¤")  ; This is the power icon
(defvar restart_icon "ï§¥")  ; This is the restart icon
(defvar wifi_icon "ï‡«")
(defvar charging_icon "ïƒ§")

(defwidget powermenu []
  (box :spacing 2
       :class "powerMenu"
    (button :onclick "$HOME/.local/bin/rofi-powermenu.sh" power_icon
      )
    )
  )

(defwidget sidebar []
  (box :class "sidebar"
      :halign "end"
      :space-evenly false
    (volum)
    (box :class "datetime" time)
    (battery)
    (powermenu)
    )
)
(defwidget volum []
	(eventbox :onhover "eww update volum=true" 		
        :class "volume-bar"
        :halign "end"
			  :onhoverlost "eww update volum=false"
	(box      :orientation "h" 	  
			  :space-evenly "false" 
			  :spacing "2"
	(revealer :transition "slideright" 
			  :reveal volum         
			  :duration "550ms"
	(scale 	  
			  :value current-volume 
			  :orientation "h"      
			  :tooltip "Volume: ${current-volume}%" 
			  :max 101 
			  :min 0 
			  :onchange "wpctl set-volume @DEFAULT_SINK@ {}%" ))
(button   :onclick "wpctl set-mute @DEFAULT_SINK@ toggle" :class "volume-icon" volume_icon)
;  (box :class "datetime" time)
;  (powermenu)
	)))
(defvar volum false)

(defwidget datetime []
  (box time)
)

(defpoll time :interval "10s"
  "date '+%Y,%b %d %H:%M'")

(defpoll current-volume :interval "1s" :initial 0 
  "wpctl get-volume @DEFAULT_SINK@ | cut -d' ' -f2|cut -d'.' -f2")

(defwidget battery [] 
  (box :space-evenly false
       :spacing "2"
  battery_status
  battery_icon
  battery_perc
  )
)
(defpoll battery_icon :initial 0 :interval "10s" "scripts/get_battery | cut -d' ' -f1")
(defpoll battery_perc :initial 0 :interval "10s" "scripts/get_battery | cut -d' ' -f2")
(defpoll battery_status :initial "" :interval "2s" "scripts/get_battery_status")

(defwidget music []
  (box :class "music"
       :orientation "h"
       :space-evenly false
       :halign "center"
    {music != "" ? "ğŸµ${music}" : ""}))

(deflisten music :initial ""
  "playerctl --follow metadata --format '{{ artist }} - {{ title }}' || true")



